<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Drama Short</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js"></script>

<style>
body{margin:0;background:#111;color:#fff;font-family:Arial}
header{position:sticky;top:0;background:#000;padding:10px;z-index:9}
button{margin:4px;padding:6px 10px;border:none;border-radius:4px}
input{padding:6px;border-radius:4px;border:none}
.grid{display:grid;grid-template-columns:repeat(auto-fill,140px);gap:12px;padding:10px}
.card{cursor:pointer}
.card img{width:100%;border-radius:8px}
.card p{font-size:12px;margin:4px 0}
video{width:100%;max-height:60vh;background:#000}
#episodes{padding:10px}
#episodes button{margin:4px}
</style>
</head>

<body>

<header>
  <button onclick="loadList('trending')">ðŸ”¥ Trending</button>
  <button onclick="loadList('latest')">ðŸ†• Latest</button>
  <button onclick="loadList('foryou')">ðŸŽ¯ For You</button>
  <button onclick="loadList('random')">ðŸŽ² Random</button>
  <button onclick="loadList('vip')">ðŸ‘‘ VIP</button>
  <button onclick="loadList('dubindo')">ðŸ‡®ðŸ‡© Dub Indo</button>
  <br><br>
  <input id="q" placeholder="Cari drama">
  <button onclick="search()">Cari</button>
</header>

<div id="list" class="grid"></div>

<video id="player" controls></video>
<div id="episodes"></div>

<script>
const API = 'https://dramabox-proxy.annasmashuri97.workers.dev'

function loadList(type){
  fetch(`${API}/${type}`)
    .then(r => r.json())
    .then(showList)
    .catch(err => alert('Gagal load data'))
}

function search(){
  const q = document.getElementById('q').value
  fetch(`${API}/search?q=${encodeURIComponent(q)}`)
    .then(r => r.json())
    .then(showList)
}

function showList(data){
  document.getElementById('episodes').innerHTML = ''
  document.getElementById('player').pause()

  document.getElementById('list').innerHTML =
    data.map(d => `
      <div class="card" onclick="loadEpisodes('${d.id || d.slug}')">
        <img src="${d.cover || d.image}">
        <p>${d.title}</p>
      </div>
    `).join('')
}

function loadEpisodes(id){
  fetch(`${API}/allepisode?id=${id}`)
    .then(r => r.json())
    .then(list => {
      document.getElementById('episodes').innerHTML =
        list.map(e => `
          <button onclick="play('${e.video || e.url}')">
            Episode ${e.episode || ''}
          </button>
        `).join('')
    })
}

function play(url){
  const video = document.getElementById('player')
  video.pause()

  if (Hls.isSupported() && url.includes('.m3u8')) {
    const hls = new Hls()
    hls.loadSource(url)
    hls.attachMedia(video)
  } else {
    video.src = url
  }
  video.play()
}

// load default
loadList('trending')
</script>

</body>
</html>
