<!-- ======= FORM ORDER (KUNINGâ€“HIJAU) ======= -->
<style>
  :root{
    --green: #22a06b;          /* hijau utama */
    --green-dark:#16885a;
    --yellow:#ffd44d;          /* kuning utama */
    --yellow-soft:#fff5cc;
    --ink:#173B2C;             /* teks utama */
    --muted:#7a8a80;
    --error:#c02929;
    --bg:#f7faf7;
    --card:#ffffff;
    --shadow: 0 10px 30px rgba(23,59,44,.10), 0 2px 10px rgba(23,59,44,.05);
    --radius:18px;
  }
  @media (prefers-color-scheme: dark){
    :root{ --card:#0f1a15; --bg:#07120e; --ink:#eaf6ef; --muted:#9fb5a9; --shadow: 0 10px 30px rgba(0,0,0,.35); }
  }
  *{ box-sizing:border-box }
  body{ background:var(--bg); font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,"Helvetica Neue",Arial; color:var(--ink); }
  .wrap{
    max-width:760px; margin:28px auto; padding:0 16px;
  }
  .card{
    background:linear-gradient(180deg, var(--card) 0%, var(--card) 55%, var(--bg) 100%);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    overflow:hidden;
    position:relative;
  }
  .ribbon{
    position:absolute; inset:auto 18px -14px auto; background:var(--yellow);
    color:#4a4a00; font-weight:700; padding:8px 14px; border-radius:10px;
    box-shadow:0 6px 16px rgba(255,212,77,.35);
  }
  .header{
    padding:28px 28px 10px; display:flex; align-items:center; gap:14px;
  }
  .logo-circle{
    width:46px; height:46px; border-radius:50%;
    background: radial-gradient(120% 120% at 30% 20%, var(--yellow) 0%, #ffe680 55%, #fff 100%);
    border:2px solid #fff; box-shadow:0 6px 18px rgba(255,212,77,.45);
  }
  .title{ font-size:22px; font-weight:800; letter-spacing:.2px; }
  .subtitle{ color:var(--muted); margin-top:2px; }

  form.loops-forms{ padding:18px 28px 28px; }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  @media (max-width:640px){ .row{ grid-template-columns:1fr; } }

  .loops-group{ margin-bottom:16px; }
  .label{
    font-weight:700; display:flex; align-items:center; justify-content:space-between;
    margin-bottom:8px;
  }
  .required{ color:var(--error); font-weight:800; margin-left:4px; }
  .input, .textarea, .select{
    width:100%; border:1.5px solid #e4efe9; background:#fff; color:var(--ink);
    border-radius:12px; padding:12px 14px; height:46px; transition:.2s border, .2s box-shadow, .2s transform;
    outline:none;
  }
  .textarea{ height:auto; min-height:110px; resize:vertical; }
  .input:focus, .textarea:focus, .select:focus{
    border-color:var(--green); box-shadow:0 0 0 3px rgba(34,160,107,.15);
  }
  .input::placeholder{ color:#9fb5a9 }
  .help{ color:var(--muted); font-size:12px; margin-top:6px }
  .msg{ font-size:13px; margin-top:8px; display:none }
  .msg.err{ color:var(--error) }
  .msg.ok{ color:var(--green-dark) }

  .cta{
    display:flex; gap:12px; align-items:center; margin-top:8px;
  }
  .btn{
    appearance:none; border:0; cursor:pointer; border-radius:14px;
    padding:12px 18px; font-weight:800; letter-spacing:.3px;
    background:linear-gradient(90deg, var(--green) 0%, #32b77d 100%);
    color:#fff; box-shadow:0 10px 22px rgba(34,160,107,.28);
    transition: transform .15s ease, box-shadow .15s ease;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 14px 26px rgba(34,160,107,.33); }
  .btn:active{ transform:translateY(0); box-shadow:0 8px 18px rgba(34,160,107,.22); }
  .btn.secondary{
    background:linear-gradient(90deg, var(--yellow) 0%, #ffe27d 100%); color:#4a4a00;
    box-shadow:0 10px 22px rgba(255,212,77,.35);
  }

  .footer{
    padding:12px 28px 26px; font-size:12px; color:var(--muted);
    display:flex; align-items:center; justify-content:space-between;
  }
  .badge{
    display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
    background:linear-gradient(180deg, var(--yellow-soft), #fff); border:1px dashed #ffe083;
    border-radius:12px; color:#564a00; font-weight:700;
  }
</style>

<div class="wrap">
  <div class="card">
    <div class="ribbon">garansi validasi WA</div>

    <div class="header">
      <div class="logo-circle"></div>
      <div>
        <div class="title">Form Pemesanan</div>
        <div class="subtitle">Kami cek nomor WhatsApp Anda duluâ€”baru pesanan dikirim ke CS.</div>
      </div>
    </div>

    <form id="loops-form-order" class="loops-forms" action="https://app.loops.id/save-order/test-lp-wa" method="POST" novalidate>
      <div class="row">
        <div class="loops-group">
          <label class="label" for="name">Nama lengkap <span class="required">*</span></label>
          <input class="input" type="text" id="name" name="name" placeholder="Tulis nama Anda" required>
        </div>

        <div class="loops-group">
          <label class="label" for="phone">No. WhatsApp <span class="required">*</span></label>
          <input class="input" type="tel" id="phone" name="phone" placeholder="0812xxxx / +62812xxxx" required>
          <div class="help">Format bebas (08/62/+62) â€” kami normalisasi otomatis.</div>
          <div id="msg" class="msg err"></div>
          <div id="msgOk" class="msg ok"></div>
        </div>
      </div>

      <div class="cta">
        <input id="loops-form-submit" type="submit" value="Beli Sekarang" class="btn">
        <button type="button" id="btnChat" class="btn secondary">Chat Admin</button>
      </div>

      <!-- Hidden fields Loops -->
      <input type="hidden" id="current" name="current" value="">
      <input type="hidden" name="redirect" value="">
      <input type="hidden" name="_loops_nonce" value="">
      <input type="hidden" id="phone_normalized" name="phone_normalized" value="">
    </form>

    <div class="footer">
      <span class="badge">ðŸ’¬ Terhubung WatZap + Cloudflare</span>
      <span>Powered by Loops.id</span>
    </div>
  </div>
</div>

<script>
  /* ===== KONFIG VIA JS ===== */
  const WORKER_VALIDATE_URL = "https://<your-worker>.workers.dev/validate"; // Ganti!
  const WA_START_CHAT       = "https://wa.me/6289674494567?text=Start";     // opsional

  /* ===== ELEMENTS ===== */
  const form = document.getElementById('loops-form-order');
  const btn = document.getElementById('loops-form-submit');
  const btnChat = document.getElementById('btnChat');
  const phoneInput = document.getElementById('phone');
  const msg = document.getElementById('msg');
  const ok = document.getElementById('msgOk');
  const hiddenNorm = document.getElementById('phone_normalized');
  const redirectField = form.querySelector('input[name="redirect"]');

  let submitting = false;

  /* ===== HELPERS ===== */
  function normalize62(input){
    const s = String(input||"").replace(/[^\d+]/g,"");
    if(!s) return "";
    if(s.startsWith("+62")) return s.slice(1);
    if(s.startsWith("62"))  return s;
    if(s.startsWith("0"))   return "62"+s.slice(1);
    if(s.startsWith("8"))   return "62"+s;
    return s.replace(/^0+/,"");
  }
  const busy = (b)=>{
    submitting = b;
    btn.value = b ? "Mengecek WhatsApp..." : "Beli Sekarang";
    btn.disabled = b;
  };
  const showErr = (t)=>{ msg.textContent=t; msg.style.display="block"; ok.style.display="none"; };
  const showOk  = (t)=>{ ok.textContent=t;  ok.style.display="block";  msg.style.display="none"; };

  btnChat.addEventListener('click', ()=> window.open(WA_START_CHAT, '_blank'));

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(submitting) return;

    showErr(""); showOk(""); msg.style.display="none"; ok.style.display="none";
    busy(true);

    try {
      const norm = normalize62(phoneInput.value);
      if(!/^62\d{7,15}$/.test(norm)){
        showErr("Nomor tidak valid. Gunakan 08xxxxx atau +628xxxxx.");
        busy(false); return;
      }

      const res = await fetch(`${WORKER_VALIDATE_URL}?phone=${encodeURIComponent(norm)}`, { cache: "no-store" });
      const j = await res.json();

      if(!j.ok){
        showErr("Validasi gagal: " + (j.error || "server"));
        busy(false); return;
      }
      if(!j.exists){
        showErr("Nomor belum terdaftar WhatsApp. Mohon cek kembali.");
        busy(false); return;
      }

      // lolos validasi
      hiddenNorm.value = norm;
      if (WA_START_CHAT) redirectField.value = WA_START_CHAT;
      showOk("Nomor terverifikasi âœ“, mengirim pesanan...");
      setTimeout(()=> form.submit(), 160);

    } catch(err){
      console.error(err);
      showErr("Terjadi kesalahan koneksi.");
      busy(false);
    }
  });

  phoneInput.addEventListener('input', ()=>{ msg.style.display="none"; ok.style.display="none"; });
</script>
